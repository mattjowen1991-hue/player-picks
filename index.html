<!DOCTYPE html>
<html lang="en">
<head>
  <!-- PWA Support -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#d4af37">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="NFL Picks">
<link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NFL Picks - Submit Your Picks</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0a0a0f;
      --bg-card: #12121a;
      --bg-game: #1a1a24;
      --gold: #d4af37;
      --gold-dim: #8b7355;
      --green: #2ecc71;
      --red: #e74c3c;
      --text: #ffffff;
      --text-muted: #8a8a9a;
      --border: #2a2a3a;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto Condensed', sans-serif;
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      background-image: 
        radial-gradient(ellipse at top, rgba(212, 175, 55, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at bottom, rgba(212, 175, 55, 0.03) 0%, transparent 50%);
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 30px;
    }

    .header h1 {
      font-family: 'Oswald', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 3px;
      background: linear-gradient(135deg, var(--gold), #f4d03f, var(--gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }

    .header .week-badge {
      display: inline-block;
      background: var(--gold);
      color: var(--bg-dark);
      font-family: 'Oswald', sans-serif;
      font-weight: 600;
      padding: 6px 20px;
      border-radius: 20px;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    /* Deadline Banner */
    .deadline-banner {
      background: linear-gradient(90deg, var(--bg-card), var(--bg-game), var(--bg-card));
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 24px;
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }

    .deadline-banner.closed {
      border-color: var(--red);
      background: linear-gradient(90deg, rgba(231, 76, 60, 0.1), rgba(231, 76, 60, 0.2), rgba(231, 76, 60, 0.1));
    }

    .deadline-banner.grace {
      border-color: #f39c12;
      background: linear-gradient(90deg, rgba(243, 156, 18, 0.1), rgba(243, 156, 18, 0.2), rgba(243, 156, 18, 0.1));
    }

    .deadline-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .deadline-time {
      font-family: 'Oswald', sans-serif;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--gold);
    }

    .countdown {
      font-family: 'Oswald', sans-serif;
      font-size: 1.2rem;
      color: var(--text);
    }

    .countdown.urgent {
      color: var(--red);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Login Section */
    .login-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 40px;
      max-width: 400px;
      margin: 60px auto;
      text-align: center;
    }

    .login-section h2 {
      font-family: 'Oswald', sans-serif;
      font-size: 1.5rem;
      margin-bottom: 24px;
      color: var(--gold);
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-group label {
      display: block;
      font-size: 0.85rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .form-group select,
    .form-group input {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-dark);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-group select:focus,
    .form-group input:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 28px;
      border: none;
      border-radius: 10px;
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--gold), #b8960b);
      color: var(--bg-dark);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.3);
    }

    .btn-primary:disabled {
      background: var(--gold-dim);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-secondary {
      background: var(--bg-game);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      border-color: var(--gold);
    }

    /* Picks Section */
    .picks-section {
      display: none;
    }

    .picks-section.active {
      display: block;
    }

    .player-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .player-name {
      font-family: 'Oswald', sans-serif;
      font-size: 1.3rem;
      color: var(--text);
    }

    .player-name span {
      color: var(--gold);
    }

    .progress-bar {
      background: var(--bg-game);
      border-radius: 20px;
      height: 8px;
      width: 200px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--gold), #f4d03f);
      border-radius: 20px;
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-left: 12px;
    }

    /* Game Card */
    .game-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      transition: border-color 0.2s;
    }

    .game-card.picked {
      border-color: var(--gold-dim);
    }

    .game-card.double-points {
      border-color: var(--gold);
      background: linear-gradient(135deg, var(--bg-card), rgba(212, 175, 55, 0.05));
    }

    .game-card.double-points::before {
      content: '‚≠ê DOUBLE POINTS';
      display: block;
      font-family: 'Oswald', sans-serif;
      font-size: 0.75rem;
      color: var(--gold);
      letter-spacing: 2px;
      margin-bottom: 12px;
      text-align: center;
    }

    .game-matchup {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 16px;
      align-items: center;
    }

    .team-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      padding: 20px;
      background: var(--bg-game);
      border: 2px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .team-btn:hover {
      background: #252535;
      border-color: var(--border);
    }

    .team-btn.selected {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
      border-color: var(--gold);
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
    }

    .team-btn.away {
      order: 0;
    }

    .team-btn.home {
      order: 2;
    }

    .team-logo {
      width: 64px;
      height: 64px;
      object-fit: contain;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    .team-name {
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-align: center;
      color: var(--text);
    }

    .team-record {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .team-tag {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .vs-badge {
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      color: var(--text-muted);
      text-transform: uppercase;
      order: 1;
    }

    /* Submit Section */
    .submit-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-top: 24px;
      text-align: center;
    }

    .submit-section .btn {
      min-width: 200px;
    }

    .submit-message {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      display: none;
    }

    .submit-message.success {
      display: block;
      background: rgba(46, 204, 113, 0.1);
      border: 1px solid var(--green);
      color: var(--green);
    }

    .submit-message.error {
      display: block;
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid var(--red);
      color: var(--red);
    }

    /* Closed State */
    .closed-message {
      text-align: center;
      padding: 60px 20px;
    }

    .closed-message h2 {
      font-family: 'Oswald', sans-serif;
      font-size: 2rem;
      color: var(--red);
      margin-bottom: 16px;
    }

    .closed-message p {
      color: var(--text-muted);
      font-size: 1.1rem;
    }

    /* Mobile Responsive */
    @media (max-width: 600px) {
      .header h1 {
        font-size: 1.8rem;
      }

      .game-matchup {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .team-btn.away { order: 0; }
      .vs-badge { order: 1; }
      .team-btn.home { order: 2; }

      .team-btn {
        flex-direction: row;
        justify-content: flex-start;
        padding: 16px;
      }

      .team-logo {
        width: 48px;
        height: 48px;
      }

      .deadline-banner {
        flex-direction: column;
        text-align: center;
      }

      .progress-bar {
        width: 100%;
      }
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top-color: currentColor;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ============================================
   VIEW ALL PICKS SECTION (Post-Deadline)
   ============================================ */
.view-picks-section {
  display: none;
  margin-top: 30px;
}

.view-picks-section.active {
  display: block;
}

.view-picks-header {
  text-align: center;
  margin-bottom: 24px;
}

.view-picks-header h2 {
  font-family: 'Oswald', sans-serif;
  font-size: 1.8rem;
  color: var(--gold);
  margin-bottom: 8px;
}

.view-picks-header p {
  color: var(--text-muted);
  font-size: 0.95rem;
}

.game-picks-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  margin-bottom: 16px;
  overflow: hidden;
}

.game-picks-card.double-points {
  border-color: var(--gold);
}

.game-picks-card.double-points .game-picks-header::after {
  content: '‚≠ê DOUBLE POINTS';
  font-size: 0.7rem;
  color: var(--gold);
  margin-left: 12px;
  letter-spacing: 1px;
}

.game-picks-header {
  background: var(--bg-game);
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  border-bottom: 1px solid var(--border);
}

.game-picks-header img {
  width: 32px;
  height: 32px;
  object-fit: contain;
}

.game-picks-title {
  font-family: 'Oswald', sans-serif;
  font-size: 1rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.game-picks-body {
  display: grid;
  grid-template-columns: 1fr 1fr;
}

.team-pickers {
  padding: 16px 20px;
}

.team-pickers:first-child {
  border-right: 1px solid var(--border);
}

.team-pickers-label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}

.team-pickers-label img {
  width: 24px;
  height: 24px;
  object-fit: contain;
}

.team-pickers-label span {
  font-family: 'Oswald', sans-serif;
  font-size: 0.85rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
}

.team-pickers-count {
  background: var(--gold);
  color: var(--bg-dark);
  font-family: 'Oswald', sans-serif;
  font-size: 0.7rem;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 10px;
  margin-left: auto;
}

.pickers-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.picker-chip {
  background: var(--bg-game);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 6px 14px;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--text);
}

.picker-chip.empty {
  color: var(--text-muted);
  font-style: italic;
  border-style: dashed;
}

.copy-whatsapp-section {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 20px;
  margin-top: 24px;
  text-align: center;
}

.copy-whatsapp-section h3 {
  font-family: 'Oswald', sans-serif;
  font-size: 1rem;
  color: var(--text);
  margin-bottom: 12px;
}

.whatsapp-preview {
  background: var(--bg-dark);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  text-align: left;
  white-space: pre-wrap;
  font-family: monospace;
  font-size: 0.8rem;
  color: var(--text-muted);
  max-height: 200px;
  overflow-y: auto;
  margin-bottom: 16px;
  user-select: all;
}

.btn-whatsapp {
  background: #25D366;
  color: white;
}

.btn-whatsapp:hover {
  background: #20bd5a;
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(37, 211, 102, 0.3);
}

.btn-whatsapp.copied {
  background: var(--green);
}

@media (max-width: 600px) {
  .game-picks-body {
    grid-template-columns: 1fr;
  }
  
  .team-pickers:first-child {
    border-right: none;
    border-bottom: 1px solid var(--border);
  }
  
  .game-picks-header {
    flex-wrap: wrap;
  }
}
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>üèà NFL Picks</h1>
      <div class="week-badge" id="weekBadge">Week --</div>
    </header>

    <!-- Deadline Banner -->
    <div class="deadline-banner" id="deadlineBanner">
      <div>
        <div class="deadline-label">Deadline</div>
        <div class="deadline-time" id="deadlineTime">Sunday 6:00 PM UK</div>
      </div>
      <div class="countdown" id="countdown">Loading...</div>
    </div>

    <!-- Login Section -->
    <section class="login-section" id="loginSection">
      <h2>Enter Your Picks</h2>
      <div class="form-group">
        <label>Select Your Name</label>
        <select id="playerSelect">
          <option value="">-- Choose Player --</option>
        </select>
      </div>
      <div class="form-group">
        <label>Your PIN</label>
        <input type="password" id="pinInput" placeholder="Enter your 4-digit PIN" maxlength="4" inputmode="numeric">
      </div>
      <button class="btn btn-primary" id="loginBtn">Continue</button>
      <div id="loginError" style="color: var(--red); margin-top: 12px; display: none;"></div>
    </section>

    <!-- Picks Section -->
    <section class="picks-section" id="picksSection">
      <div class="player-header">
        <div class="player-name">Making picks as <span id="currentPlayerName"></span></div>
        <div style="display: flex; align-items: center;">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
          </div>
          <span class="progress-text" id="progressText">0/0 picked</span>
        </div>
      </div>

      <div id="gamesContainer"></div>

      <div class="submit-section">
        <button class="btn btn-primary" id="submitBtn">
          <span id="submitBtnText">Submit Picks</span>
        </button>
        <div class="submit-message" id="submitMessage"></div>
      </div>
    </section>

    <!-- Closed Message -->
    <section class="closed-message" id="closedSection" style="display: none;">
      <h2>‚è∞ Picks Are Closed</h2>
      <p>The deadline has passed. Better luck next week!</p>
    </section>

    <!-- View All Picks Section (shows after deadline) -->
    <section class="view-picks-section" id="viewPicksSection">
      <div class="view-picks-header">
        <h2>üìã Week <span id="viewPicksWeek"></span> Picks</h2>
        <p>See who picked what for each game</p>
      </div>
      
      <div id="allPicksContainer"></div>
      
      <div class="copy-whatsapp-section">
        <h3>üì± Share to WhatsApp</h3>
        <div class="whatsapp-preview" id="whatsappPreview">Loading...</div>
        <button class="btn btn-whatsapp" id="copyWhatsAppBtn">üìã Copy to Clipboard</button>
      </div>
    </section>
  </div>

  <script>
    // ============================================
    // CONFIGURATION - EDIT THESE VALUES
    // ============================================
    const CONFIG = {
      // JSONBin.io settings (you'll get these after creating your bin)
      JSONBIN_BIN_ID: '69487a81ae596e708fa937cb',
      JSONBIN_API_KEY: '$2a$10$C7BY0Kl0u74gNn/kXO7xNuayWv493/f1jAxlHUmx3ENADQKDii61C',
      
      // Current week number
      WEEK: 18,
      
      // Deadline: Sunday 6:00 PM UK time (18:00)
      // Format: 'YYYY-MM-DDTHH:MM:SS' in UK time
      // The system adds a 10-minute grace period automatically
      DEADLINE: '2026-01-03T18:00:00', // Change this each week
      GRACE_PERIOD_MINUTES: 10,
      
      // Players and their PINs (keep this secret!)
      PLAYERS: {
  'matt': '2922',
  'jarv': '8351',
  'gaz': '6194',
  'joe': '2847',
  'ben': '9563',
  'coley': '3718',
  'mark': '5926',
  'ste': '1482',
  'tony': '7035',
  'jay': '4263',
  'lee': '8914',
  'liam': '6357'
},
      
      // Games for this week
      // Set doublePoints: true for double point games
      GAMES: [
        { home: 'Houston Texans', away: 'Indianapolis Colts', doublePoints: true },
        { home: 'Cincinnati Bengals', away: 'Cleveland Browns', doublePoints: true },
        { home: 'Atlanta Falcons', away: 'New Orleans Saints', doublePoints: true },
        { home: 'Minnesota Vikings', away: 'Green Bay Packers', doublePoints: true },
        { home: 'Jacksonville Jaguars', away: 'Tennessee Titans', doublePoints: true },
        { home: 'New York Giants', away: 'Dallas Cowboys', doublePoints: true },
      ]
    };

    // NFL Team logos (using ESPN's CDN)
    const TEAM_LOGOS = {
      'Arizona Cardinals': 'https://a.espncdn.com/i/teamlogos/nfl/500/ari.png',
      'Atlanta Falcons': 'https://a.espncdn.com/i/teamlogos/nfl/500/atl.png',
      'Baltimore Ravens': 'https://a.espncdn.com/i/teamlogos/nfl/500/bal.png',
      'Buffalo Bills': 'https://a.espncdn.com/i/teamlogos/nfl/500/buf.png',
      'Carolina Panthers': 'https://a.espncdn.com/i/teamlogos/nfl/500/car.png',
      'Chicago Bears': 'https://a.espncdn.com/i/teamlogos/nfl/500/chi.png',
      'Cincinnati Bengals': 'https://a.espncdn.com/i/teamlogos/nfl/500/cin.png',
      'Cleveland Browns': 'https://a.espncdn.com/i/teamlogos/nfl/500/cle.png',
      'Dallas Cowboys': 'https://a.espncdn.com/i/teamlogos/nfl/500/dal.png',
      'Denver Broncos': 'https://a.espncdn.com/i/teamlogos/nfl/500/den.png',
      'Detroit Lions': 'https://a.espncdn.com/i/teamlogos/nfl/500/det.png',
      'Green Bay Packers': 'https://a.espncdn.com/i/teamlogos/nfl/500/gb.png',
      'Houston Texans': 'https://a.espncdn.com/i/teamlogos/nfl/500/hou.png',
      'Indianapolis Colts': 'https://a.espncdn.com/i/teamlogos/nfl/500/ind.png',
      'Jacksonville Jaguars': 'https://a.espncdn.com/i/teamlogos/nfl/500/jax.png',
      'Kansas City Chiefs': 'https://a.espncdn.com/i/teamlogos/nfl/500/kc.png',
      'Las Vegas Raiders': 'https://a.espncdn.com/i/teamlogos/nfl/500/lv.png',
      'Los Angeles Chargers': 'https://a.espncdn.com/i/teamlogos/nfl/500/lac.png',
      'Los Angeles Rams': 'https://a.espncdn.com/i/teamlogos/nfl/500/lar.png',
      'Miami Dolphins': 'https://a.espncdn.com/i/teamlogos/nfl/500/mia.png',
      'Minnesota Vikings': 'https://a.espncdn.com/i/teamlogos/nfl/500/min.png',
      'New England Patriots': 'https://a.espncdn.com/i/teamlogos/nfl/500/ne.png',
      'New Orleans Saints': 'https://a.espncdn.com/i/teamlogos/nfl/500/no.png',
      'New York Giants': 'https://a.espncdn.com/i/teamlogos/nfl/500/nyg.png',
      'New York Jets': 'https://a.espncdn.com/i/teamlogos/nfl/500/nyj.png',
      'Philadelphia Eagles': 'https://a.espncdn.com/i/teamlogos/nfl/500/phi.png',
      'Pittsburgh Steelers': 'https://a.espncdn.com/i/teamlogos/nfl/500/pit.png',
      'San Francisco 49ers': 'https://a.espncdn.com/i/teamlogos/nfl/500/sf.png',
      'Seattle Seahawks': 'https://a.espncdn.com/i/teamlogos/nfl/500/sea.png',
      'Tampa Bay Buccaneers': 'https://a.espncdn.com/i/teamlogos/nfl/500/tb.png',
      'Tennessee Titans': 'https://a.espncdn.com/i/teamlogos/nfl/500/ten.png',
      'Washington Commanders': 'https://a.espncdn.com/i/teamlogos/nfl/500/wsh.png'
    };

    // ============================================
    // STATE
    // ============================================
    let currentPlayer = null;
    let picks = {}; // { gameIndex: teamName }
    let existingPicks = null; // Previously submitted picks

    // ============================================
    // DEADLINE LOGIC
    // ============================================
    function getDeadlineDate() {
      // Parse as UK time
      const deadline = new Date(CONFIG.DEADLINE + '+00:00'); // Treat as UTC for simplicity
      return deadline;
    }

    function getGraceDeadline() {
      const deadline = getDeadlineDate();
      return new Date(deadline.getTime() + CONFIG.GRACE_PERIOD_MINUTES * 60 * 1000);
    }

    function isBeforeDeadline() {
      return new Date() < getDeadlineDate();
    }

    function isInGracePeriod() {
      const now = new Date();
      return now >= getDeadlineDate() && now < getGraceDeadline();
    }

    function isPicksClosed() {
      return new Date() >= getGraceDeadline();
    }

    function updateCountdown() {
      const now = new Date();
      const deadline = getDeadlineDate();
      const graceDeadline = getGraceDeadline();
      const banner = document.getElementById('deadlineBanner');
      const countdown = document.getElementById('countdown');

      if (isPicksClosed()) {
        banner.classList.add('closed');
        countdown.textContent = '‚ùå CLOSED';
        countdown.classList.add('urgent');
        showClosedState();
        return;
      }

      if (isInGracePeriod()) {
        banner.classList.add('grace');
        const diff = graceDeadline - now;
        const mins = Math.floor(diff / 60000);
        const secs = Math.floor((diff % 60000) / 1000);
        countdown.textContent = `‚ö†Ô∏è GRACE PERIOD: ${mins}:${secs.toString().padStart(2, '0')}`;
        countdown.classList.add('urgent');
        return;
      }

      const diff = deadline - now;
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const secs = Math.floor((diff % (1000 * 60)) / 1000);

      if (days > 0) {
        countdown.textContent = `${days}d ${hours}h ${mins}m remaining`;
      } else if (hours > 0) {
        countdown.textContent = `${hours}h ${mins}m ${secs}s remaining`;
      } else if (mins > 10) {
        countdown.textContent = `${mins}m ${secs}s remaining`;
      } else {
        countdown.textContent = `${mins}m ${secs}s remaining`;
        countdown.classList.add('urgent');
      }
    }

    function showClosedState() {
  document.getElementById('loginSection').style.display = 'none';
  document.getElementById('picksSection').classList.remove('active');
  document.getElementById('closedSection').style.display = 'block';
  
  // Show the View All Picks section
  document.getElementById('viewPicksSection').classList.add('active');
  loadAndDisplayAllPicks();
  setupWhatsAppCopy();
}

    // ============================================
    // UI INITIALIZATION
    // ============================================
    function init() {
      document.getElementById('weekBadge').textContent = `Week ${CONFIG.WEEK}`;
      
      // Populate player dropdown
      const select = document.getElementById('playerSelect');
      Object.keys(CONFIG.PLAYERS).sort().forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name.charAt(0).toUpperCase() + name.slice(1);
        select.appendChild(option);
      });

      // Update countdown every second
      updateCountdown();
      setInterval(updateCountdown, 1000);

      // Event listeners
      document.getElementById('loginBtn').addEventListener('click', handleLogin);
      document.getElementById('submitBtn').addEventListener('click', handleSubmit);
      document.getElementById('pinInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleLogin();
      });

      // Check if already closed
      if (isPicksClosed()) {
        showClosedState();
      }
    }

    // ============================================
    // LOGIN / LOGOUT
    // ============================================
    async function handleLogin() {
      const playerName = document.getElementById('playerSelect').value;
      const pin = document.getElementById('pinInput').value;
      const errorEl = document.getElementById('loginError');

      if (!playerName) {
        errorEl.textContent = 'Please select your name';
        errorEl.style.display = 'block';
        return;
      }

      if (!pin) {
        errorEl.textContent = 'Please enter your PIN';
        errorEl.style.display = 'block';
        return;
      }

      if (CONFIG.PLAYERS[playerName] !== pin) {
    errorEl.textContent = 'Incorrect PIN. Try again.';
    errorEl.style.display = 'block';
    return;
  }

  // Show loading IMMEDIATELY
  const loginBtn = document.getElementById('loginBtn');
  loginBtn.disabled = true;
  loginBtn.innerHTML = '<span class="spinner"></span> Loading...';

  errorEl.style.display = 'none';
  currentPlayer = playerName;

      // Load existing picks if any
      await loadExistingPicks();

      showPicksSection();
    }

    // ============================================
    // PICKS UI
    // ============================================
    function showPicksSection() {
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('picksSection').classList.add('active');
      document.getElementById('currentPlayerName').textContent = 
        currentPlayer.charAt(0).toUpperCase() + currentPlayer.slice(1);
      
      renderGames();
      updateProgress();
    }

    function renderGames() {
      const container = document.getElementById('gamesContainer');
      container.innerHTML = '';

      CONFIG.GAMES.forEach((game, index) => {
        const card = document.createElement('div');
        card.className = 'game-card' + (game.doublePoints ? ' double-points' : '');
        card.dataset.index = index;

        const homeLogo = TEAM_LOGOS[game.home] || '';
        const awayLogo = TEAM_LOGOS[game.away] || '';

        // Check if there's an existing pick
        const existingPick = existingPicks?.[currentPlayer]?.[index];
        if (existingPick) {
          picks[index] = existingPick;
          card.classList.add('picked');
        }

        card.innerHTML = `
          <div class="game-matchup">
            <button class="team-btn away ${picks[index] === game.away ? 'selected' : ''}" data-team="${game.away}" data-index="${index}">
              <img src="${awayLogo}" alt="${game.away}" class="team-logo" onerror="this.style.display='none'">
              <div>
                <div class="team-name">${game.away}</div>
                <div class="team-tag">Away</div>
              </div>
            </button>
            <div class="vs-badge">@</div>
            <button class="team-btn home ${picks[index] === game.home ? 'selected' : ''}" data-team="${game.home}" data-index="${index}">
              <img src="${homeLogo}" alt="${game.home}" class="team-logo" onerror="this.style.display='none'">
              <div>
                <div class="team-name">${game.home}</div>
                <div class="team-tag">Home</div>
              </div>
            </button>
          </div>
        `;

        // Add click handlers
        card.querySelectorAll('.team-btn').forEach(btn => {
          btn.addEventListener('click', () => handlePick(btn));
        });

        container.appendChild(card);
      });
    }

    function handlePick(btn) {
      if (isPicksClosed()) {
        alert('Sorry, picks are now closed!');
        return;
      }

      const index = parseInt(btn.dataset.index);
      const team = btn.dataset.team;
      const card = btn.closest('.game-card');

      // Deselect other button in same game
      card.querySelectorAll('.team-btn').forEach(b => b.classList.remove('selected'));
      
      // Select this button
      btn.classList.add('selected');
      card.classList.add('picked');

      // Store pick
      picks[index] = team;
      updateProgress();
    }

    function updateProgress() {
      const total = CONFIG.GAMES.length;
      const picked = Object.keys(picks).length;
      const percent = (picked / total) * 100;

      document.getElementById('progressFill').style.width = `${percent}%`;
      document.getElementById('progressText').textContent = `${picked}/${total} picked`;

      // Enable/disable submit button
      document.getElementById('submitBtn').disabled = picked !== total;
    }

    // ============================================
    // DATA STORAGE (JSONBin.io)
    // ============================================
    async function loadExistingPicks() {
      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_BIN_ID}/latest`, {
          headers: {
            'X-Access-Key': CONFIG.JSONBIN_API_KEY
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          existingPicks = data.record?.picks || {};
        }
      } catch (err) {
        console.log('No existing picks found or error loading:', err);
        existingPicks = {};
      }
    }

    async function savePicks() {
      // Load current data first
      let currentData = { week: CONFIG.WEEK, picks: {}, submissions: [] };
      
      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_BIN_ID}/latest`, {
          headers: {
            'X-Access-Key': CONFIG.JSONBIN_API_KEY
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          currentData = data.record || currentData;
        }
      } catch (err) {
        console.log('Starting fresh:', err);
      }

      // Update with this player's picks
      currentData.picks[currentPlayer] = picks;
      currentData.submissions = currentData.submissions || [];
      currentData.submissions.push({
        player: currentPlayer,
        timestamp: new Date().toISOString(),
        inGracePeriod: isInGracePeriod()
      });

      // Save back
      const saveResponse = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_BIN_ID}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Access-Key': CONFIG.JSONBIN_API_KEY
        },
        body: JSON.stringify(currentData)
      });

      if (!saveResponse.ok) {
        throw new Error('Failed to save picks');
      }

      return true;
    }

    // ============================================
    // SUBMIT
    // ============================================
    async function handleSubmit() {
      if (isPicksClosed()) {
        alert('Sorry, picks are now closed!');
        return;
      }

      const btn = document.getElementById('submitBtn');
      const btnText = document.getElementById('submitBtnText');
      const message = document.getElementById('submitMessage');

      // Validate all picks made
      if (Object.keys(picks).length !== CONFIG.GAMES.length) {
        message.textContent = 'Please make a pick for every game!';
        message.className = 'submit-message error';
        return;
      }

      // Show loading
      btn.disabled = true;
      btnText.innerHTML = '<span class="spinner"></span> Submitting...';

      try {
        await savePicks();
        
        message.textContent = '‚úÖ Your picks have been submitted successfully!';
        message.className = 'submit-message success';
        btnText.textContent = 'Picks Submitted!';

        // Store locally that they submitted
        existingPicks = existingPicks || {};
        existingPicks[currentPlayer] = { ...picks };

      } catch (err) {
        console.error('Submit error:', err);
        message.textContent = '‚ùå Error submitting picks. Please try again.';
        message.className = 'submit-message error';
        btn.disabled = false;
        btnText.textContent = 'Submit Picks';
      }
    }

    // ============================================
// VIEW ALL PICKS (Post-Deadline)
// ============================================
async function loadAndDisplayAllPicks() {
  const container = document.getElementById('allPicksContainer');
  const whatsappPreview = document.getElementById('whatsappPreview');
  
  document.getElementById('viewPicksWeek').textContent = CONFIG.WEEK;
  
  try {
    const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_BIN_ID}/latest`, {
      headers: { 'X-Access-Key': CONFIG.JSONBIN_API_KEY }
    });
    
    if (!response.ok) throw new Error('Failed to load picks');
    
    const data = await response.json();
    const allPicks = data.record?.picks || {};
    
    // Render game cards
    let html = '';
    let whatsappText = `üèà WEEK ${CONFIG.WEEK} PICKS üèà\n`;
    
    CONFIG.GAMES.forEach((game, index) => {
      const homePickers = [];
      const awayPickers = [];
      
      Object.keys(allPicks).forEach(player => {
        const pick = allPicks[player]?.[index];
        if (pick === game.home) {
          homePickers.push(capitalize(player));
        } else if (pick === game.away) {
          awayPickers.push(capitalize(player));
        }
      });
      
      const awayShort = game.away.split(' ').pop();
      const homeShort = game.home.split(' ').pop();
      
      html += `
        <div class="game-picks-card${game.doublePoints ? ' double-points' : ''}">
          <div class="game-picks-header">
            <img src="${TEAM_LOGOS[game.away]}" alt="" onerror="this.style.display='none'">
            <span class="game-picks-title">${awayShort} @ ${homeShort}</span>
          </div>
          <div class="game-picks-body">
            <div class="team-pickers">
              <div class="team-pickers-label">
                <img src="${TEAM_LOGOS[game.away]}" alt="" onerror="this.style.display='none'">
                <span>${awayShort}</span>
                <span class="team-pickers-count">${awayPickers.length}</span>
              </div>
              <div class="pickers-list">
                ${awayPickers.length > 0 
                  ? awayPickers.map(p => `<span class="picker-chip">${p}</span>`).join('')
                  : '<span class="picker-chip empty">None</span>'}
              </div>
            </div>
            <div class="team-pickers">
              <div class="team-pickers-label">
                <img src="${TEAM_LOGOS[game.home]}" alt="" onerror="this.style.display='none'">
                <span>${homeShort}</span>
                <span class="team-pickers-count">${homePickers.length}</span>
              </div>
              <div class="pickers-list">
                ${homePickers.length > 0 
                  ? homePickers.map(p => `<span class="picker-chip">${p}</span>`).join('')
                  : '<span class="picker-chip empty">None</span>'}
              </div>
            </div>
          </div>
        </div>
      `;
      
      // WhatsApp format
      whatsappText += `\n${game.away} @ ${game.home}${game.doublePoints ? ' ‚≠ê' : ''}\n`;
      whatsappText += `‚Ä¢ ${homeShort} ‚Üí ${homePickers.join(', ') || 'None'}\n`;
      whatsappText += `‚Ä¢ ${awayShort} ‚Üí ${awayPickers.join(', ') || 'None'}\n`;
    });
    
    container.innerHTML = html;
    whatsappPreview.textContent = whatsappText.trim();
    
  } catch (err) {
    console.error('Error loading picks:', err);
    container.innerHTML = `
      <div style="text-align: center; padding: 40px; color: var(--text-muted);">
        <p>Unable to load picks. Please refresh the page.</p>
      </div>
    `;
  }
}

function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}

function setupWhatsAppCopy() {
  const btn = document.getElementById('copyWhatsAppBtn');
  btn.addEventListener('click', () => {
    const text = document.getElementById('whatsappPreview').textContent;
    navigator.clipboard.writeText(text).then(() => {
      btn.textContent = '‚úì Copied!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'üìã Copy to Clipboard';
        btn.classList.remove('copied');
      }, 2000);
    });
  });
}

    // Start the app
    init();
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(() => console.log('‚úÖ Service Worker registered'))
      .catch(err => console.log('Service Worker error:', err));
  }
</script>
</body>
</html>
